<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Realidad Aumentada con WebXR y A-Frame</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script>
    // Componente de oclusión para crear materiales que solo escriben en el buffer de profundidad
    AFRAME.registerComponent('occlusion', {
      init: function () {
        const material = new THREE.MeshStandardMaterial({
          colorWrite: false // Hace el material invisible pero aún afecta la profundidad
        });
        this.el.object3D.traverse((obj) => {
          if (obj.isMesh) obj.material = material;
        });
      }
    });
  </script>
</head>
<body>
  <a-scene xrweb="hitTest: true;" renderer="antialias: true; colorManagement: true; shadowMapEnabled: true; shadowMapType: PCFSoftShadowMap;">
    <!-- Configuración de la cámara para AR en WebXR -->
    <a-camera look-controls="enabled: false" wasd-controls-enabled="false"></a-camera>

    <!-- Configuración de luces detallada para emitir sombras -->
    <a-light type="directional" color="#FFFFFF" intensity="1" position="3 4 5" target="#scene" cast-shadow="true" 
      shadow-camera-near="0.1" shadow-camera-far="100" shadow-camera-left="-10" shadow-camera-right="10" shadow-camera-top="10" shadow-camera-bottom="-10"></a-light>
    <a-light type="ambient" color="#888888" intensity="0.5"></a-light>

    <!-- Entidad que realiza oclusión y muestra modelos -->
    <a-entity xrweb-hit-test="createAnchor: true">
      <a-box position="0 0 0" width="0.5" height="0.5" depth="0.5" occlusion shadow="cast: true; receive: true"></a-box>
      <a-gltf-model src="path/to/your/cactus.glb" scale="0.5 0.5 0.5" position="0 0 0" rotation="0 0 0" shadow="cast: true; receive: true"></a-gltf-model>
    </a-entity>

    <!-- Suelo virtual para recibir sombras -->
    <a-plane position="0 0 -1" rotation="-90 0 0" width="10" height="10" shadow="receive: true"></a-plane>
  </a-scene>
</body>
</html>
